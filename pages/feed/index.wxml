<view class="container">
  <!-- æ’åºç­›é€‰å™¨ -->
  <view class="sort-section">
    <view class="sort-selector" bindtap="toggleSort">
      <text class="sort-text">æ’åº: {{sorts[activeSort]}}</text>
      <text class="sort-arrow" wx:if="{{!sortOpen}}">â–¼</text>
      <text class="sort-arrow" wx:else>â–²</text>
    </view>
    <view wx:if="{{sortOpen}}" class="sort-menu">
      <view wx:for="{{sorts}}" wx:key="index" class="sort-option {{index === activeSort ? 'active' : ''}}" data-index="{{index}}" bindtap="selectSort">
        {{item}}
      </view>
    </view>
  </view>

  <!-- åŠ¨æ€åˆ—è¡¨ -->
  <block wx:for="{{list}}" wx:key="id">
    <view class="post-card">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="post-header">
        <image class="avatar" src="{{item.avatar}}" mode="aspectFill" />
        <view class="user-info">
          <text class="username">{{item.user}}</text>
          <view class="post-meta">
            <text class="post-time">{{item.time}}</text>
            <view wx:if="{{item.place}}" class="location-info">
              <text class="location-icon">ğŸ“</text>
              <text class="location-text">{{item.place}}</text>
              <text wx:if="{{item.distance}}" class="distance-text">{{item.distance}}km</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ–‡æœ¬å†…å®¹ -->
      <view wx:if="{{item.content}}" class="post-content">
        {{item.content}}
      </view>

      <!-- å›¾ç‰‡å†…å®¹ -->
      <view wx:if="{{item.photos && item.photos.length > 0}}" class="post-images">
        <view wx:if="{{item.photos.length === 1}}" class="single-image">
          <image class="image-item" src="{{item.photos[0]}}" mode="aspectFill" bindtap="previewImage" data-urls="{{item.photos}}" data-index="0" />
        </view>
        <view wx:elif="{{item.photos.length === 2}}" class="two-images">
          <image wx:for="{{item.photos}}" wx:for-item="photo" wx:for-index="photoIndex" wx:key="photoIndex" class="image-item" src="{{photo}}" mode="aspectFill" bindtap="previewImage" data-urls="{{item.photos}}" data-index="{{photoIndex}}" />
        </view>
        <view wx:elif="{{item.photos.length === 3}}" class="three-images">
          <image wx:for="{{item.photos}}" wx:for-item="photo" wx:for-index="photoIndex" wx:key="photoIndex" class="image-item" src="{{photo}}" mode="aspectFill" bindtap="previewImage" data-urls="{{item.photos}}" data-index="{{photoIndex}}" />
        </view>
        <view wx:elif="{{item.photos.length === 4}}" class="four-images">
          <image wx:for="{{item.photos}}" wx:for-item="photo" wx:for-index="photoIndex" wx:key="photoIndex" class="image-item" src="{{photo}}" mode="aspectFill" bindtap="previewImage" data-urls="{{item.photos}}" data-index="{{photoIndex}}" />
        </view>
        <view wx:else class="multi-images">
          <image wx:for="{{item.photos}}" wx:for-item="photo" wx:for-index="photoIndex" wx:key="photoIndex" class="image-item" src="{{photo}}" mode="aspectFill" bindtap="previewImage" data-urls="{{item.photos}}" data-index="{{photoIndex}}" />
        </view>
      </view>

      <!-- äº’åŠ¨åŒºåŸŸ -->
      <view class="post-actions">
        <view class="action-item" data-id="{{item.id}}" bindtap="onLike">
          <text class="action-icon">{{item.liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-text">ç‚¹èµ</text>
          <text wx:if="{{item.likes > 0}}" class="action-count">{{item.likes}}</text>
        </view>
        <view class="action-item" data-id="{{item.id}}" bindtap="onComment">
          <text class="action-icon">ğŸ’¬</text>
          <text class="action-text">è¯„è®º</text>
          <text wx:if="{{item.comments > 0}}" class="action-count">{{item.comments}}</text>
        </view>
      </view>

      <!-- è¯„è®ºåˆ—è¡¨ -->
      <view wx:if="{{item.commentList && item.commentList.length > 0}}" class="comment-list">
        <view wx:for="{{item.commentList}}" wx:key="id" class="comment-item">
          <image class="comment-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-user">{{item.user}}</text>
              <text class="comment-time">{{item.time}}</text>
            </view>
            <text class="comment-text">{{item.content}}</text>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- è¯„è®ºè¾“å…¥æ¡†å¼¹çª— -->
  <view wx:if="{{showCommentInput}}" class="comment-modal" bindtap="hideCommentInput">
    <!-- é€æ˜å…³é—­åŒºåŸŸ -->
    <view class="modal-close-area" bindtap="hideCommentInput"></view>
    <view class="comment-modal-content" catchtap>
      <view class="comment-modal-header">
        <text class="comment-modal-title">å†™è¯„è®º</text>
        <text class="comment-modal-close" bindtap="hideCommentInput">âœ•</text>
      </view>
      <textarea
        class="comment-input"
        placeholder="è¯·è¾“å…¥è¯„è®ºå†…å®¹..."
        value="{{commentInputValue}}"
        bindinput="onCommentInput"
        bindblur="onCommentBlur"
        auto-focus
        maxlength="200"
        cursor-spacing="{{20}}"
        show-count="{{false}}"
        adjust-position="{{true}}"
      />
      <view class="comment-modal-actions">
        <button class="btn-cancel" bindtap="hideCommentInput">å–æ¶ˆ</button>
        <button class="btn-submit" bindtap="onSendComment" disabled="{{!commentInputValue || commentInputValue.trim().length === 0}}">
          <text wx:if="{{!commentInputValue || commentInputValue.trim().length === 0}}" style="color: #999;">å‘é€</text>
          <text wx:else style="color: #fff;">å‘é€</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{list.length === 0}}" class="empty-state">
    <text class="empty-text">æš‚æ— åŠ¨æ€å†…å®¹</text>
  </view>
</view>
